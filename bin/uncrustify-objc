#!/bin/bash
set -euo pipefail

if [[ $# < 1 ]]; then
    cat <<EOT
uncrustify-objc - Format Objective-C code with Uncrustify.
https://github.com/ElfSundae/uncrustify-objc

Usage: $(basename "$0") dir [dir] [dir] ...
EOT
    exit 1
fi

ROOT="$(dirname "$0")/.."
uncrustify="$ROOT/uncrustify/uncrustify"
configFile="$ROOT/uncrustify/uncrustify.cfg"

find "$@" -type f \
    ! -path "*/.*/*" \
    ! -path "*/*.framework/*" ! -path "*/*.xcframework/*" \
    ! -path "*/Pods/*" ! -path "*/Carthage/*" \
    ! -path "*/Rome/*" \
    \( -name "*.[hm]" -o -name "*.mm" \) \
    -exec "$uncrustify" -c "$configFile" -l OC --replace --no-backup {} \;
